# ğŸš€ Railway éƒ¨ç½²æŒ‡å—

## æ¶æ§‹æ¦‚è¦½

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Railway å°ˆæ¡ˆ: BRM                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚  brm-web     â”‚        â”‚  brm-worker  â”‚                  â”‚
â”‚  â”‚  (Next.js)   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”‚  (WebSocket) â”‚                  â”‚
â”‚  â”‚  Frontend +  â”‚        â”‚  Data Sync   â”‚                  â”‚
â”‚  â”‚  API Routes  â”‚        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚                           â”‚
â”‚         â”‚                       â”‚                           â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â”‚                     â”‚                                        â”‚
â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚
â”‚            â”‚     Redis       â”‚                             â”‚
â”‚            â”‚  (å³æ™‚æ•¸æ“šå¿«å–)  â”‚                             â”‚
â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚
â”‚                     â”‚                                        â”‚
â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚
â”‚            â”‚   PostgreSQL    â”‚                             â”‚
â”‚            â”‚  (æ­·å²æ•¸æ“šå­˜å„²)  â”‚                             â”‚
â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“¦ éƒ¨ç½²æ­¥é©Ÿ

### 1. æº–å‚™ Railway é …ç›®

1. ç™»éŒ„ [Railway.app](https://railway.app)
2. å‰µå»ºæ–°é …ç›®æˆ–ä½¿ç”¨ç¾æœ‰é …ç›®
3. å¾ GitHub é€£æ¥æ­¤å€‰åº«

### 2. æ·»åŠ æœå‹™æ’ä»¶

#### æ·»åŠ  Redis
```bash
# åœ¨ Railway Dashboard ä¸­ï¼š
1. é»æ“Š "New" â†’ "Database" â†’ "Add Redis"
2. Redis URL æœƒè‡ªå‹•æ³¨å…¥åˆ°ç’°å¢ƒè®Šé‡ REDIS_URL
```

#### æ·»åŠ  PostgreSQL
```bash
# åœ¨ Railway Dashboard ä¸­ï¼š
1. é»æ“Š "New" â†’ "Database" â†’ "Add PostgreSQL"  
2. DATABASE_URL æœƒè‡ªå‹•æ³¨å…¥åˆ°ç’°å¢ƒè®Šé‡
```

### 3. é…ç½®æœå‹™

Railway æœƒè‡ªå‹•è­˜åˆ¥ `railway.toml` ä¸¦å‰µå»ºå…©å€‹æœå‹™ï¼š

#### Service 1: **brm-web** (å‰ç«¯ + API)
- **é¡å‹**: Web Service
- **å•Ÿå‹•å‘½ä»¤**: `npm run start`
- **å¥åº·æª¢æŸ¥**: `/api/health`
- **è‡ªå‹•åŸŸå**: Railway æœƒè‡ªå‹•åˆ†é… `.up.railway.app` åŸŸå

#### Service 2: **brm-worker** (å¯¦æ™‚æ•¸æ“šåŒæ­¥)
- **é¡å‹**: Worker Service  
- **å•Ÿå‹•å‘½ä»¤**: `npm run worker`
- **åŠŸèƒ½**: WebSocket è¨‚é–± Binance æ•¸æ“šæµä¸¦å¯«å…¥ Redis

### 4. ç’°å¢ƒè®Šé‡

Railway æœƒè‡ªå‹•æ³¨å…¥ä»¥ä¸‹è®Šé‡ï¼š
- âœ… `REDIS_URL` - Redis é€£æ¥å­—ç¬¦ä¸²
- âœ… `DATABASE_URL` - PostgreSQL é€£æ¥å­—ç¬¦ä¸²
- âœ… `PORT` - Web æœå‹™ç«¯å£

å¯é¸è‡ªå®šç¾©è®Šé‡ï¼š
```env
SYMBOL=btcusdt          # äº¤æ˜“å° (é è¨­: btcusdt)
NODE_ENV=production     # ç’°å¢ƒ
```

### 5. éƒ¨ç½²

```bash
# æ¨é€ä»£ç¢¼åˆ° GitHub
git add .
git commit -m "feat: add real-time data integration"
git push origin main

# Railway æœƒè‡ªå‹•è§¸ç™¼éƒ¨ç½²
```

## ğŸ” é©—è­‰éƒ¨ç½²

### æª¢æŸ¥ Web æœå‹™
```bash
# è¨ªå•ä½ çš„ Railway åŸŸå
curl https://your-app.up.railway.app/api/health

# é æœŸéŸ¿æ‡‰ï¼š
{"ok":true,"ts":1234567890,"service":"brm-web"}
```

### æª¢æŸ¥ Worker æ—¥èªŒ
åœ¨ Railway Dashboard ä¸­æŸ¥çœ‹ `brm-worker` æœå‹™æ—¥èªŒï¼Œæ‡‰è©²çœ‹åˆ°ï¼š
```
ğŸš€ BRM Worker starting...
ğŸ“Š Trading pair: BTCUSDT
ğŸ”´ Redis: redis://***@***:6379
ğŸ”Œ Connecting to Binance WebSocket...
âœ… WebSocket connected!
ğŸ“Š Ticker: $67234.50 (+2.34%)
ğŸ“– OrderBook updated: spread $10.50 | bids: 20 | asks: 20
```

### æ¸¬è©¦å¯¦æ™‚æ•¸æ“š
```bash
# æ¸¬è©¦åƒ¹æ ¼ API
curl https://your-app.up.railway.app/api/price

# é æœŸéŸ¿æ‡‰ï¼š
{
  "source": "redis",
  "symbol": "BTCUSDT",
  "price": 67234.50,
  "changePercent": 2.34,
  ...
}

# æ¸¬è©¦è¨‚å–®ç°¿ API
curl https://your-app.up.railway.app/api/orderbook

# é æœŸéŸ¿æ‡‰ï¼š
{
  "source": "redis",
  "bids": [...],
  "asks": [...],
  ...
}
```

## ğŸ“Š æ•¸æ“šæµèªªæ˜

### Real-time Flow (å¯¦æ™‚æ•¸æ“šæµ)

```
Binance WebSocket
      â”‚
      â”œâ”€â–º Ticker Stream (1s æ›´æ–°)
      â”œâ”€â–º OrderBook Stream (100ms æ›´æ–°)
      â”œâ”€â–º Trade Stream (å³æ™‚)
      â””â”€â–º Kline Stream (1m Kç·š)
      â”‚
      â–¼
  brm-worker
      â”‚
      â”œâ”€â–º Redis Cache (60s TTL)
      â”‚   â”œâ”€ ticker:latest
      â”‚   â”œâ”€ orderbook:latest
      â”‚   â”œâ”€ trades:recent (100ç­†)
      â”‚   â””â”€ klines:1m (100æ ¹)
      â”‚
      â””â”€â–º Redis Pub/Sub
          â”œâ”€ ticker:updates
          â”œâ”€ orderbook:updates
          â””â”€ alerts
      â”‚
      â–¼
  Next.js API Routes
      â”‚
      â””â”€â–º Frontend (5s è¼ªè©¢)
```

### Historical Data Flow (æ­·å²æ•¸æ“š)

```
brm-worker
      â”‚
      â”œâ”€â–º å®Œæˆçš„ Kç·š
      â”œâ”€â–º å¤§å–®äº¤æ˜“è¨˜éŒ„
      â””â”€â–º åƒ¹æ ¼è­¦å ±
      â”‚
      â–¼
  PostgreSQL
      â”‚
      â”œâ”€ price_history è¡¨
      â”œâ”€ trades è¡¨
      â””â”€ alerts è¡¨
      â”‚
      â–¼
  æœªä¾†åŠŸèƒ½ï¼š
  - æŠ€è¡“æŒ‡æ¨™è¨ˆç®—
  - æ­·å²å›æ¸¬
  - ç”¨æˆ¶è­¦å ±è¨­ç½®
```

## ğŸ¯ Railway ç‰¹æœ‰åŠŸèƒ½åˆ©ç”¨

### 1. **è‡ªå‹•æ“´å±•**
Railway æœƒæ ¹æ“šæµé‡è‡ªå‹•æ“´å±• `brm-web` æœå‹™

### 2. **é›¶åœæ©Ÿéƒ¨ç½²**
æ¯æ¬¡æ¨é€ä»£ç¢¼ï¼ŒRailway æœƒï¼š
1. æ§‹å»ºæ–°ç‰ˆæœ¬
2. é‹è¡Œå¥åº·æª¢æŸ¥
3. ç„¡ç¸«åˆ‡æ›æµé‡

### 3. **å³æ™‚æ—¥èªŒ**
```bash
# åœ¨ Railway Dashboard æŸ¥çœ‹å¯¦æ™‚æ—¥èªŒ
- brm-web: æŸ¥çœ‹ API è«‹æ±‚å’ŒéŒ¯èª¤
- brm-worker: æŸ¥çœ‹ WebSocket é€£æ¥ç‹€æ…‹å’Œæ•¸æ“šæ›´æ–°
```

### 4. **è§€æ¸¬æŒ‡æ¨™**
Railway æä¾›ï¼š
- CPU ä½¿ç”¨ç‡
- å…§å­˜ä½¿ç”¨
- ç¶²çµ¡æµé‡
- è«‹æ±‚å»¶é²

### 5. **ç’°å¢ƒéš”é›¢**
```bash
# å¯ä»¥å‰µå»ºå¤šå€‹ç’°å¢ƒ
- production (ä¸»åˆ†æ”¯)
- staging (develop åˆ†æ”¯)
- preview (PR åˆ†æ”¯)
```

## ğŸ”§ æœ¬åœ°é–‹ç™¼

### å•Ÿå‹• Web æœå‹™
```bash
npm run dev
```

### å•Ÿå‹• Worker (éœ€è¦æœ¬åœ° Redis)
```bash
# æ–¹æ³•1: ä½¿ç”¨ Docker
docker run -d -p 6379:6379 redis:alpine

# æ–¹æ³•2: é€£æ¥ Railway Redis
export REDIS_URL="redis://default:xxx@xxx.railway.internal:6379"
npm run worker
```

### åŒæ™‚é‹è¡Œ
```bash
# Terminal 1
npm run dev

# Terminal 2  
npm run worker:watch
```

## ğŸ“ˆ ç›£æ§èˆ‡ç¶­è­·

### æª¢æŸ¥ Worker å¥åº·ç‹€æ…‹
```bash
# åœ¨ Redis CLI ä¸­æŸ¥çœ‹çµ±è¨ˆ
redis-cli GET worker:stats

# è¼¸å‡ºç¯„ä¾‹ï¼š
{
  "ticker": 1234,
  "orderbook": 5678,
  "trades": 890,
  "uptime": 3600,
  "connected": true
}
```

### é‡å•Ÿæœå‹™
```bash
# åœ¨ Railway Dashboard:
1. é€²å…¥å°æ‡‰æœå‹™
2. é»æ“Š "Restart"
```

### æ“´å±•å»ºè­°

#### ç•¶ç”¨æˆ¶é‡å¢é•·æ™‚ï¼š
1. **æ·»åŠ  Redis å‰¯æœ¬** - è®€å¯«åˆ†é›¢
2. **ä½¿ç”¨ Pub/Sub** - æ¨é€æ•¸æ“šåˆ°å‰ç«¯ (WebSocket)
3. **æ·»åŠ  CDN** - éœæ…‹è³‡æºåŠ é€Ÿ
4. **æ•¸æ“šåº«å„ªåŒ–** - æ·»åŠ ç´¢å¼•ã€åˆ†è¡¨

## ğŸš¨ æ•…éšœæ’é™¤

### Worker ç„¡æ³•é€£æ¥ WebSocket
```bash
# æª¢æŸ¥æ—¥èªŒä¸­æ˜¯å¦æœ‰éŒ¯èª¤
# å¸¸è¦‹åŸå› ï¼š
1. ç¶²çµ¡å•é¡Œ - Railway åˆ° Binance çš„é€£æ¥
2. é€Ÿç‡é™åˆ¶ - Binance API é™åˆ¶
3. Redis é€£æ¥å¤±æ•—

# è§£æ±ºæ–¹æ¡ˆï¼šWorker æœƒè‡ªå‹•é‡é€£ï¼ˆæœ€å¤š10æ¬¡ï¼‰
```

### API è¿”å›ç©ºæ•¸æ“š
```bash
# å¯èƒ½åŸå› ï¼šWorker æœªé‹è¡Œæˆ– Redis æ•¸æ“šéæœŸ
# æª¢æŸ¥ï¼š
1. Worker æ—¥èªŒæ˜¯å¦æ­£å¸¸
2. Redis ä¸­æ˜¯å¦æœ‰æ•¸æ“š: redis-cli GET ticker:latest
3. API æœƒè‡ªå‹• fallback åˆ°ç›´æ¥èª¿ç”¨ Binance
```

## ğŸ“ ä¸‹ä¸€æ­¥

- [ ] æ·»åŠ  PostgreSQL Prisma schema
- [ ] å¯¦ç¾æ­·å²æ•¸æ“šå­˜å„²
- [ ] æ·»åŠ ç”¨æˆ¶è­¦å ±ç³»çµ±
- [ ] å¯¦ç¾ WebSocket æ¨é€åˆ°å‰ç«¯
- [ ] æ·»åŠ å¤šå¹£ç¨®æ”¯æŒ
- [ ] æŠ€è¡“æŒ‡æ¨™è¨ˆç®—ï¼ˆRSI, MACDï¼‰

---

**éƒ¨ç½²æ™‚é–“**: ~5 åˆ†é˜  
**æˆæœ¬**: Railway Hobby Plan ($5/æœˆ) æˆ– Pro Plan ($20/æœˆ)  
**æ”¯æŒ**: 24/7 è‡ªå‹•ç›£æ§èˆ‡å‘Šè­¦
